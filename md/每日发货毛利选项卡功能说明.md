# 每日发货毛利选项卡功能说明

## 概述

每日发货毛利模块提供了5个可点击的统计卡片（选项卡），用户可以通过点击不同的卡片来查看不同的数据视图。

## 选项卡说明

### 1. 总毛利（金额）

- **类型**：金额统计
- **说明**：显示筛选条件下的总毛利金额
- **点击效果**：显示"利润与运费趋势"图表
- **默认状态**：未选中时也显示图表

### 2. 总运费（金额）

- **类型**：金额统计
- **说明**：显示筛选条件下的总运费金额
- **点击效果**：显示"利润与运费趋势"图表
- **默认状态**：未选中时也显示图表

### 3. 总订单（数量）

- **类型**：数量统计
- **说明**：显示筛选条件下的所有订单数量
- **点击效果**：显示"利润与运费趋势"图表
- **默认状态**：未选中时也显示图表

### 4. 毛利率低（数量）

- **类型**：数量统计
- **说明**：显示毛利率低于20%的订单数量
- **点击效果**：显示"毛利率低订单列表"表格
- **表格列**：
  - 单号
  - 店铺名
  - 付款时间（仅显示年月日）
  - SKU
  - 物流渠道
  - 商品总成本
  - 运费
  - 毛利
  - 利润率
  - 运费回款

### 5. 无运费补贴（数量）

- **类型**：数量统计
- **说明**：显示运费回款为0的订单数量
- **点击效果**：显示"无运费补贴订单列表"表格
- **表格列**：
  - 单号
  - 店铺名
  - 付款时间（仅显示年月日）
  - SKU
  - 物流渠道
  - 商品总成本
  - 运费
  - 毛利
  - 利润率
  - 运费回款

## 功能特性

### 选项卡交互

1. **选中状态**：点击选项卡后，卡片会显示蓝色边框（`ring-2 ring-primary`）表示选中
2. **悬停效果**：鼠标悬停时卡片会显示阴影效果（`hover:shadow-md`）
3. **点击切换**：点击不同的选项卡会切换显示的内容

### 图表视图

当点击"总毛利"、"总运费"、"总订单"或未选中任何选项卡时，显示：

- **利润与运费趋势图表**
  - 蓝色柱状图：表示每日利润
  - 绿色折线图：表示每日运费
  - 支持点击数据点查看当日订单详情（功能待实现）

### 表格视图

当点击"毛利率低"或"无运费补贴"时，显示：

- **订单列表表格**
  - 显示符合条件的订单详情
  - 表格顶部显示订单总数
  - 支持横向滚动（当列数较多时）
  - 表格行有悬停效果

## 数据筛选

所有选项卡的数据都受以下筛选条件影响：

1. **日期范围**：通过日期选择器选择开始日期和结束日期
2. **店铺筛选**：通过下拉菜单选择特定店铺或"全部店铺"

筛选条件变化时，所有统计数据会自动更新。

## 使用流程

### 查看趋势图表

1. 选择日期范围和店铺（可选）
2. 点击"总毛利"、"总运费"或"总订单"选项卡（或不点击任何选项卡）
3. 查看下方的"利润与运费趋势"图表

### 查看订单列表

1. 选择日期范围和店铺（可选）
2. 点击"毛利率低"选项卡 → 查看毛利率低于20%的订单列表
3. 或点击"无运费补贴"选项卡 → 查看运费回款为0的订单列表

## 技术实现

### 状态管理

```typescript
const [activeTab, setActiveTab] = useState<'profit' | 'shipping' | 'orders' | 'lowProfitRate' | 'noShippingRefund' | null>(null)
const [filteredOrders, setFilteredOrders] = useState<any[]>([])
const [loadingOrders, setLoadingOrders] = useState(false)
```

### 数据加载

- **统计数据**：通过 `fetchOrdersStatistics` 获取
- **订单列表**：通过 `fetchOrdersList` 获取，支持按筛选类型过滤

### 筛选逻辑

- **毛利率低**：`profit_rate < 20`
- **无运费补贴**：`shipping_refund === 0` 或 `null` 或 `undefined`

## 注意事项

1. 表格数据加载时会有"加载中..."提示
2. 如果筛选条件下没有符合条件的订单，表格会显示"暂无订单数据"
3. 付款时间仅显示年月日格式（YYYY-MM-DD），不显示具体时间
4. 所有金额和数字字段都使用 `formatCurrency` 函数格式化显示

## 相关文件

- **组件文件**：`components/daily-profit-report.tsx`
- **Server Actions**：`app/actions/orders.ts`
- **数据层**：`lib/orders-data.ts`

