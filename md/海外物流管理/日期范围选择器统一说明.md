# 日期范围选择器统一说明

## 一、统一改造概述

为了提升用户体验，将项目中所有的日期选择器统一改为使用 `react-day-picker` 的日期范围选择器组件，支持双月视图和范围选择。

## 二、新增组件

### DateRangePicker 组件

**文件位置**：`components/ui/date-range-picker.tsx`

**功能特性**：
- ✅ 双月并排显示（`numberOfMonths={2}`）
- ✅ 日期范围选择（`mode="range"`）
- ✅ 中文界面支持（星期、月份显示为中文）
- ✅ 日期格式兼容（输出 `YYYY-MM-DD` 格式，与后端API兼容）
- ✅ 响应式设计，适配移动端和桌面端

**组件接口**：
```typescript
interface DateRangePickerProps {
  dateFrom?: string        // 开始日期（YYYY-MM-DD格式）
  dateTo?: string          // 结束日期（YYYY-MM-DD格式）
  onDateChange?: (dateFrom: string | undefined, dateTo: string | undefined) => void
  className?: string
  placeholder?: string     // 默认："选择日期范围"
}
```

**使用示例**：
```typescript
<DateRangePicker
  dateFrom={dateFrom}
  dateTo={dateTo}
  onDateChange={(from, to) => {
    setDateFrom(from || "")
    setDateTo(to || "")
  }}
  placeholder="选择日期范围"
/>
```

## 三、已替换的组件

### 1. 海外物流管理组件

**文件**：`components/overseas-logistics.tsx`

**修改前**：
```tsx
<Input type="date" value={dateFrom} onChange={(e) => setDateFrom(e.target.value)} />
<Input type="date" value={dateTo} onChange={(e) => setDateTo(e.target.value)} />
```

**修改后**：
```tsx
<DateRangePicker
  dateFrom={dateFrom}
  dateTo={dateTo}
  onDateChange={(from, to) => {
    setDateFrom(from || "")
    setDateTo(to || "")
  }}
/>
```

### 2. 历史任务组件

**文件**：`components/history-tasks.tsx`

**修改前**：
```tsx
<Input type="date" value={dateFrom} onChange={(e) => setDateFrom(e.target.value)} />
<Input type="date" value={dateTo} onChange={(e) => setDateTo(e.target.value)} />
```

**修改后**：
```tsx
<DateRangePicker
  dateFrom={dateFrom}
  dateTo={dateTo}
  onDateChange={(from, to) => {
    setDateFrom(from || "")
    setDateTo(to || "")
  }}
/>
```

## 四、日期格式兼容性

### 格式说明

- **输入格式**：`YYYY-MM-DD`（例如：`2024-01-15`）
- **输出格式**：`YYYY-MM-DD`（与后端API完全兼容）
- **显示格式**：`MM月dd日`（例如：`01月15日`）

### 兼容性保证

1. **后端API兼容**：
   - 所有后端API期望的日期格式为 `YYYY-MM-DD`
   - `DateRangePicker` 组件输出格式为 `YYYY-MM-DD`
   - 完全兼容，无需修改后端代码

2. **数据筛选兼容**：
   - `dateFrom` 和 `dateTo` 的格式保持不变
   - 筛选逻辑无需修改
   - 与现有的 `getLogisticsData` 和 `getLogisticsStatistics` 函数完全兼容

3. **状态管理兼容**：
   - 组件状态仍使用 `string` 类型（`YYYY-MM-DD` 格式）
   - 与现有的 `useState<string>` 完全兼容

## 五、功能特性

### 1. 日期范围选择

- 支持选择开始日期和结束日期
- 支持只选择开始日期（结束日期为 `undefined`）
- 支持清空选择（两个日期都为 `undefined`）

### 2. 双月视图

- 默认显示两个月份（当前月和下一月）
- 方便选择跨月的日期范围
- 支持月份导航（左右箭头）

### 3. 中文界面

- 星期显示：`一 二 三 四 五 六 日`
- 月份显示：`一月 2024`、`二月 2024`
- 日期显示：`01月15日 - 01月20日`

### 4. 交互体验

- 点击按钮打开日期选择器
- 点击外部区域自动关闭
- 选择日期后自动关闭（可选）
- 显示当前选中的日期范围

## 六、技术实现

### 依赖库

- `react-day-picker`: `9.8.0` - 日期选择器核心库
- `date-fns`: `4.1.0` - 日期格式化库
- `@radix-ui/react-popover` - 弹出层组件

### 核心代码逻辑

```typescript
// 1. 字符串日期转换为 Date 对象
const fromDate = dateFrom ? new Date(dateFrom) : undefined
const toDate = dateTo ? new Date(dateTo) : undefined

// 2. 日期范围选择处理
const handleSelect = (range: DateRange | undefined) => {
  if (range?.from) {
    const fromStr = format(range.from, 'yyyy-MM-dd')
    const toStr = range.to ? format(range.to, 'yyyy-MM-dd') : undefined
    onDateChange?.(fromStr, toStr)
  } else {
    onDateChange?.(undefined, undefined)
  }
}

// 3. 显示文本格式化
const displayText = date?.from && date?.to
  ? `${format(date.from, 'MM月dd日', { locale: zhCN })} - ${format(date.to, 'MM月dd日', { locale: zhCN })}`
  : placeholder
```

## 七、使用注意事项

### 1. 日期格式

- 确保传入的 `dateFrom` 和 `dateTo` 为 `YYYY-MM-DD` 格式
- 组件会自动处理格式转换

### 2. 空值处理

- 如果 `dateFrom` 或 `dateTo` 为空字符串，组件会显示占位符
- 清空选择时，`onDateChange` 会传递 `undefined`

### 3. 时区问题

- 组件使用本地时区
- 日期选择不受时区影响（只选择日期，不选择时间）

### 4. 响应式设计

- 在移动端，日期选择器会自动适配
- 双月视图在小屏幕上可能显示为单月

## 八、测试建议

### 1. 功能测试

- ✅ 选择日期范围
- ✅ 只选择开始日期
- ✅ 清空日期选择
- ✅ 重置筛选功能
- ✅ 日期筛选功能

### 2. 兼容性测试

- ✅ 与现有筛选逻辑兼容
- ✅ 与后端API兼容
- ✅ 与导出功能兼容
- ✅ 与爬虫功能兼容

### 3. UI测试

- ✅ 中文显示正确
- ✅ 双月视图显示正常
- ✅ 日期范围高亮正确
- ✅ 响应式布局正常

## 九、后续优化建议

1. **添加快捷选择**：
   - 今天
   - 最近7天
   - 最近30天
   - 本月
   - 上月

2. **添加日期验证**：
   - 确保结束日期不早于开始日期
   - 添加日期范围限制

3. **性能优化**：
   - 大量数据时考虑虚拟滚动
   - 优化日期格式化性能

## 十、总结

✅ **已完成**：
- 创建统一的日期范围选择器组件
- 替换海外物流管理组件的日期选择器
- 替换历史任务组件的日期选择器
- 确保日期格式兼容性（YYYY-MM-DD）
- 支持中文界面
- 支持双月视图

✅ **兼容性保证**：
- 与后端API完全兼容
- 与现有筛选逻辑完全兼容
- 与导出、爬虫等功能完全兼容

所有日期选择器已统一为新的日期范围选择器组件，用户体验得到提升，功能完全兼容。

