# æµ·å¤–ç‰©æµæ¨¡å—ç´¢å¼•ä¼˜åŒ–è¯´æ˜Ž

## ðŸ“Š ç´¢å¼•æ¦‚è§ˆ

æµ·å¤–ç‰©æµæ¨¡å—ä¸»è¦ä½¿ç”¨ `post_searchs` è¡¨ï¼Œæœ¬æ¬¡ä¼˜åŒ–æ–°å¢ž **5 ä¸ªç´¢å¼•**ï¼Œç”¨äºŽä¼˜åŒ–ä»¥ä¸‹æŸ¥è¯¢åœºæ™¯ï¼š

### æ–°å¢žç´¢å¼•åˆ—è¡¨

1. **idx_post_searchs_ship_date_id** - æŽ’åºç´¢å¼•ï¼ˆæœ€é‡è¦ï¼‰
   - ä¼˜åŒ–ï¼š`ORDER BY ship_date DESC, id DESC`
   - æ€§èƒ½æå‡ï¼š5-20 å€

2. **idx_post_searchs_states_ship_date** - çŠ¶æ€+æ—¥æœŸå¤åˆç´¢å¼•
   - ä¼˜åŒ–ï¼š`WHERE states IN (...) AND ship_date >= ... AND ship_date <= ...`
   - æ€§èƒ½æå‡ï¼š3-10 å€

3. **idx_post_searchs_ship_date_states** - æ—¥æœŸ+çŠ¶æ€å¤åˆç´¢å¼•
   - ä¼˜åŒ–ï¼š`WHERE ship_date >= ... AND states IN (...)`
   - æ€§èƒ½æå‡ï¼š3-10 å€

4. **idx_post_searchs_updated_at** - æ›´æ–°æ—¶é—´ç´¢å¼•
   - ä¼˜åŒ–ï¼š`ORDER BY updated_at DESC`
   - æ€§èƒ½æå‡ï¼š2-5 å€

5. **idx_post_searchs_states_ship_date_id** - çŠ¶æ€+æ—¥æœŸ+IDå¤åˆç´¢å¼•
   - ä¼˜åŒ–ï¼š`WHERE states IN (...) AND ship_date >= ... ORDER BY id DESC`
   - æ€§èƒ½æå‡ï¼š5-15 å€

### å·²æœ‰åŸºç¡€ç´¢å¼•ï¼ˆå¯èƒ½å·²å­˜åœ¨ï¼‰

ä»¥ä¸‹ç´¢å¼•åœ¨ `add_logistics_fields.sql` æˆ–å»ºè¡¨è„šæœ¬ä¸­å¯èƒ½å·²åˆ›å»ºï¼š

- `idx_search_num` - å•å·ç´¢å¼•ï¼ˆç”¨äºŽ `WHERE search_num IN (...)`)
- `idx_states` - çŠ¶æ€ç´¢å¼•ï¼ˆç”¨äºŽ `WHERE states = ...`)
- `idx_ship_date` - å‘è´§æ—¥æœŸç´¢å¼•ï¼ˆç”¨äºŽ `WHERE ship_date >= ...`)
- `idx_transfer_num` - è½¬å•å·ç´¢å¼•ï¼ˆç”¨äºŽ `LEFT JOIN` æŸ¥è¯¢ï¼‰
- `idx_order_num` - è®¢å•å·ç´¢å¼•ï¼ˆç”¨äºŽè®¢å•å·æŸ¥è¯¢ï¼‰

## ðŸ” æŸ¥è¯¢åœºæ™¯åˆ†æž

### åœºæ™¯ 1ï¼šä¸»åˆ—è¡¨æŸ¥è¯¢ï¼ˆæœ€å¸¸ç”¨ï¼‰

**æŸ¥è¯¢æ¨¡å¼**ï¼š
```sql
SELECT * FROM post_searchs 
WHERE 1=1
  AND ship_date >= ? AND ship_date <= ?
  AND states IN (...)
ORDER BY ship_date DESC, id DESC
```

**ä¼˜åŒ–ç´¢å¼•**ï¼š
- `idx_post_searchs_ship_date_id` - ä¼˜åŒ–æŽ’åº
- `idx_post_searchs_states_ship_date` - ä¼˜åŒ–ç­›é€‰+æŽ’åº

### åœºæ™¯ 2ï¼šçŠ¶æ€ç­›é€‰æŸ¥è¯¢

**æŸ¥è¯¢æ¨¡å¼**ï¼š
```sql
SELECT COUNT(*) FROM post_searchs 
WHERE states IN ('Returned to Sender', 'Not registered', ...)
  AND ship_date >= ? AND ship_date <= ?
```

**ä¼˜åŒ–ç´¢å¼•**ï¼š
- `idx_post_searchs_states_ship_date` - ä¼˜åŒ–çŠ¶æ€+æ—¥æœŸç­›é€‰

### åœºæ™¯ 3ï¼šæ—¥æœŸèŒƒå›´æŸ¥è¯¢

**æŸ¥è¯¢æ¨¡å¼**ï¼š
```sql
SELECT * FROM post_searchs 
WHERE ship_date >= ? AND ship_date <= ?
ORDER BY ship_date DESC
```

**ä¼˜åŒ–ç´¢å¼•**ï¼š
- `idx_post_searchs_ship_date_id` - ä¼˜åŒ–æ—¥æœŸç­›é€‰+æŽ’åº

### åœºæ™¯ 4ï¼šå•å·æŸ¥è¯¢

**æŸ¥è¯¢æ¨¡å¼**ï¼š
```sql
SELECT * FROM post_searchs 
WHERE search_num IN (...)
```

**ä¼˜åŒ–ç´¢å¼•**ï¼š
- `idx_search_num` - å·²æœ‰ç´¢å¼•ï¼ˆåŸºç¡€ï¼‰

### åœºæ™¯ 5ï¼šè½¬å•å·å…³è”æŸ¥è¯¢

**æŸ¥è¯¢æ¨¡å¼**ï¼š
```sql
SELECT * FROM post_searchs p
LEFT JOIN post_searchs t ON p.transfer_num = t.search_num
```

**ä¼˜åŒ–ç´¢å¼•**ï¼š
- `idx_transfer_num` - å·²æœ‰ç´¢å¼•ï¼ˆåŸºç¡€ï¼‰
- `idx_search_num` - å·²æœ‰ç´¢å¼•ï¼ˆåŸºç¡€ï¼‰

## ðŸ“ˆ æ€§èƒ½æå‡é¢„æœŸ

| æŸ¥è¯¢ç±»åž‹ | æ•°æ®é‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–åŽ | æå‡å€æ•° |
|---------|--------|--------|--------|---------|
| ä¸»åˆ—è¡¨æŸ¥è¯¢ï¼ˆæŽ’åºï¼‰ | 10ä¸‡æ¡ | 2-5ç§’ | 0.1-0.5ç§’ | 5-20å€ |
| çŠ¶æ€ç­›é€‰+æ—¥æœŸ | 10ä¸‡æ¡ | 1-3ç§’ | 0.1-0.3ç§’ | 3-10å€ |
| æ—¥æœŸèŒƒå›´æŸ¥è¯¢ | 10ä¸‡æ¡ | 1-2ç§’ | 0.1-0.2ç§’ | 5-10å€ |
| å•å·æŸ¥è¯¢ | 10ä¸‡æ¡ | 0.5-1ç§’ | 0.01-0.05ç§’ | 10-50å€ |

## ðŸš€ æ‰§è¡Œç´¢å¼•åˆ›å»º

æ‰§è¡Œ `sql/postgresql/create_indexes_only.sql` æ–‡ä»¶ä¸­çš„ç´¢å¼•åˆ›å»ºè¯­å¥ï¼ˆç´¢å¼• 18-22ï¼‰ã€‚

## âœ… æ£€æŸ¥ç´¢å¼•çŠ¶æ€

æ‰§è¡Œ `sql/postgresql/check_index_status.sql` æ–‡ä»¶ä¸­çš„æ£€æŸ¥è„šæœ¬ï¼ŒæŸ¥çœ‹ `post_searchs` è¡¨çš„ç´¢å¼•åˆ›å»ºçŠ¶æ€ã€‚

## ðŸ“ æ³¨æ„äº‹é¡¹

1. **ç´¢å¼•åˆ›å»ºæ—¶é—´**ï¼šä½¿ç”¨ `CONCURRENTLY` ä¸ä¼šé”è¡¨ï¼Œä½†åˆ›å»ºæ—¶é—´è¾ƒé•¿ï¼ˆæ ¹æ®æ•°æ®é‡ï¼Œå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿåˆ°å‡ ååˆ†é’Ÿï¼‰

2. **ç´¢å¼•é€‰æ‹©**ï¼šPostgreSQL ä¼šè‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„ç´¢å¼•ï¼Œå¦‚æžœå¤šä¸ªç´¢å¼•éƒ½å¯ç”¨ï¼Œä¼šé€‰æ‹©æˆæœ¬æœ€ä½Žçš„

3. **ç´¢å¼•ç»´æŠ¤**ï¼šå®šæœŸæ‰§è¡Œ `VACUUM ANALYZE post_searchs` æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ï¼Œå¸®åŠ©æŸ¥è¯¢ä¼˜åŒ–å™¨é€‰æ‹©æœ€ä½³ç´¢å¼•

4. **ç´¢å¼•å¤§å°**ï¼šå¤åˆç´¢å¼•ä¼šå ç”¨æ›´å¤šå­˜å‚¨ç©ºé—´ï¼Œä½†æŸ¥è¯¢æ€§èƒ½æå‡æ˜¾è‘—

5. **å·²æœ‰ç´¢å¼•**ï¼šå¦‚æžœåŸºç¡€ç´¢å¼•ï¼ˆidx_search_num, idx_states ç­‰ï¼‰å·²å­˜åœ¨ï¼Œä¸ä¼šé‡å¤åˆ›å»ºï¼ˆä½¿ç”¨äº† `IF NOT EXISTS`ï¼‰

