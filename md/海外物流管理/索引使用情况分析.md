# ç´¢å¼•ä½¿ç”¨æƒ…å†µåˆ†æžæŠ¥å‘Š

## ðŸ“Š æ€»ä½“æƒ…å†µ

æ ¹æ®ç´¢å¼•ä½¿ç”¨ç»Ÿè®¡ï¼Œ`post_searchs` è¡¨çš„ç´¢å¼•ä½¿ç”¨æƒ…å†µå¦‚ä¸‹ï¼š

### ç´¢å¼•åˆ†ç±»ç»Ÿè®¡

| åˆ†ç±» | æ•°é‡ | è¯´æ˜Ž |
|------|------|------|
| âœ… ä½¿ç”¨é¢‘ç¹ | 7ä¸ª | ä½¿ç”¨æ¬¡æ•° > 100 |
| ðŸ”¸ ä½¿ç”¨ä¸€èˆ¬ | 3ä¸ª | ä½¿ç”¨æ¬¡æ•° 10-100 |
| ðŸ”¶ ä½¿ç”¨è¾ƒå°‘ | 1ä¸ª | ä½¿ç”¨æ¬¡æ•° < 10 |
| âš ï¸ æœªä½¿ç”¨ | 2ä¸ª | ä½¿ç”¨æ¬¡æ•° = 0 |

## ðŸ” è¯¦ç»†åˆ†æž

### âœ… ä½¿ç”¨é¢‘ç¹çš„ç´¢å¼•ï¼ˆæ ¸å¿ƒç´¢å¼•ï¼‰

#### 1. `post_searchs_search_num_key` - å•å·å”¯ä¸€çº¦æŸ
- **ä½¿ç”¨æ¬¡æ•°**: 55,611 æ¬¡ï¼ˆæœ€é«˜ï¼‰
- **ç´¢å¼•å¤§å°**: 96 kB
- **è¯´æ˜Ž**: è¿™æ˜¯å”¯ä¸€çº¦æŸç´¢å¼•ï¼Œç”¨äºŽä¿è¯ `search_num` çš„å”¯ä¸€æ€§ï¼Œæ˜¯ç³»ç»Ÿæœ€å¸¸ç”¨çš„ç´¢å¼•
- **å»ºè®®**: âœ… ä¿ç•™ï¼Œè¿™æ˜¯æ ¸å¿ƒç´¢å¼•

#### 2. `idx_states` - çŠ¶æ€ç´¢å¼•
- **ä½¿ç”¨æ¬¡æ•°**: 2,058 æ¬¡
- **ç´¢å¼•å¤§å°**: 48 kB
- **è¯»å–å…ƒç»„æ•°**: 382,455
- **è¯´æ˜Ž**: ç”¨äºŽçŠ¶æ€ç­›é€‰æŸ¥è¯¢ï¼Œä½¿ç”¨éžå¸¸é¢‘ç¹
- **å»ºè®®**: âœ… ä¿ç•™ï¼ŒçŠ¶æ€ç­›é€‰çš„æ ¸å¿ƒç´¢å¼•

#### 3. `post_searchs_pkey` - ä¸»é”®ç´¢å¼•
- **ä½¿ç”¨æ¬¡æ•°**: 5,543 æ¬¡
- **ç´¢å¼•å¤§å°**: 72 kB
- **è¯´æ˜Ž**: ä¸»é”®ç´¢å¼•ï¼Œç³»ç»Ÿå¿…éœ€
- **å»ºè®®**: âœ… ä¿ç•™ï¼Œç³»ç»Ÿå¿…éœ€

#### 4. `idx_post_searchs_ship_date_id` - æ—¥æœŸæŽ’åºç´¢å¼• â­
- **ä½¿ç”¨æ¬¡æ•°**: 861 æ¬¡
- **ç´¢å¼•å¤§å°**: 88 kB
- **è¯´æ˜Ž**: **æœ€é‡è¦çš„æŽ’åºç´¢å¼•**ï¼Œç”¨äºŽ `ORDER BY ship_date DESC, id DESC`
- **å»ºè®®**: âœ… ä¿ç•™ï¼Œè¿™æ˜¯é»˜è®¤æ—¥æœŸèŒƒå›´æŸ¥è¯¢çš„æ ¸å¿ƒç´¢å¼•

#### 5. `idx_ship_date` - åŸºç¡€æ—¥æœŸç´¢å¼• â­
- **ä½¿ç”¨æ¬¡æ•°**: 394 æ¬¡
- **ç´¢å¼•å¤§å°**: 40 kB
- **è¯»å–å…ƒç»„æ•°**: 43,796
- **è¯´æ˜Ž**: **åŸºç¡€æ—¥æœŸç´¢å¼•**ï¼Œç”¨äºŽæ—¥æœŸèŒƒå›´ç­›é€‰ï¼ˆ`WHERE ship_date >= ? AND ship_date <= ?`ï¼‰
- **å»ºè®®**: âœ… ä¿ç•™ï¼Œé»˜è®¤æ—¥æœŸèŒƒå›´æŸ¥è¯¢å¿…éœ€

#### 6. `idx_search_num` - å•å·ç´¢å¼•
- **ä½¿ç”¨æ¬¡æ•°**: 789 æ¬¡
- **ç´¢å¼•å¤§å°**: 96 kB
- **è¯´æ˜Ž**: ç”¨äºŽå•å·æŸ¥è¯¢
- **å»ºè®®**: âœ… ä¿ç•™

#### 7. `idx_transfer_num` - è½¬å•å·ç´¢å¼•
- **ä½¿ç”¨æ¬¡æ•°**: 509 æ¬¡
- **ç´¢å¼•å¤§å°**: 40 kB
- **è¯»å–å…ƒç»„æ•°**: 83,739
- **è¯´æ˜Ž**: ç”¨äºŽè½¬å•å·æŸ¥è¯¢å’Œ LEFT JOIN
- **å»ºè®®**: âœ… ä¿ç•™

### ðŸ”¸ ä½¿ç”¨ä¸€èˆ¬çš„ç´¢å¼•ï¼ˆå¤åˆç´¢å¼•ï¼‰

#### 1. `idx_post_searchs_states_ship_date` - çŠ¶æ€+æ—¥æœŸå¤åˆç´¢å¼•
- **ä½¿ç”¨æ¬¡æ•°**: 85 æ¬¡
- **ç´¢å¼•å¤§å°**: 40 kB
- **è¯»å–å…ƒç»„æ•°**: 14,141
- **è¯´æ˜Ž**: ç”¨äºŽçŠ¶æ€ç­›é€‰ + æ—¥æœŸèŒƒå›´æŸ¥è¯¢
- **å»ºè®®**: âœ… ä¿ç•™ï¼Œè™½ç„¶ä½¿ç”¨æ¬¡æ•°ä¸å¤šï¼Œä½†åœ¨ç‰¹å®šæŸ¥è¯¢åœºæ™¯ä¸‹å¾ˆæœ‰ç”¨

#### 2. `idx_post_searchs_states_ship_date_id` - çŠ¶æ€+æ—¥æœŸ+IDå¤åˆç´¢å¼•
- **ä½¿ç”¨æ¬¡æ•°**: 35 æ¬¡
- **ç´¢å¼•å¤§å°**: 168 kB
- **è¯´æ˜Ž**: ç”¨äºŽå¤æ‚çš„çŠ¶æ€+æ—¥æœŸ+IDæŽ’åºæŸ¥è¯¢
- **å»ºè®®**: âœ… ä¿ç•™ï¼Œè™½ç„¶ä½¿ç”¨æ¬¡æ•°ä¸å¤šï¼Œä½†å¯ä»¥ä¼˜åŒ–å¤æ‚æŸ¥è¯¢

#### 3. `idx_post_searchs_ship_date_states` - æ—¥æœŸ+çŠ¶æ€å¤åˆç´¢å¼•
- **ä½¿ç”¨æ¬¡æ•°**: 18 æ¬¡
- **ç´¢å¼•å¤§å°**: 40 kB
- **è¯´æ˜Ž**: ç”¨äºŽæ—¥æœŸèŒƒå›´ + çŠ¶æ€ç­›é€‰æŸ¥è¯¢
- **å»ºè®®**: âœ… ä¿ç•™ï¼Œä¸Ž `idx_post_searchs_states_ship_date` äº’è¡¥

### ðŸ”¶ ä½¿ç”¨è¾ƒå°‘çš„ç´¢å¼•

#### 1. `idx_order_num` - è®¢å•å·ç´¢å¼•
- **ä½¿ç”¨æ¬¡æ•°**: 5 æ¬¡
- **ç´¢å¼•å¤§å°**: 40 kB
- **è¯´æ˜Ž**: ç”¨äºŽè®¢å•å·æŸ¥è¯¢ï¼Œä½†ä½¿ç”¨å¾ˆå°‘
- **å»ºè®®**: âš ï¸ å¦‚æžœè®¢å•å·æŸ¥è¯¢åŠŸèƒ½ä¸å¸¸ç”¨ï¼Œå¯ä»¥è€ƒè™‘åˆ é™¤ä»¥èŠ‚çœç©ºé—´

### âš ï¸ æœªä½¿ç”¨çš„ç´¢å¼•ï¼ˆå»ºè®®åˆ é™¤ï¼‰

#### 1. `idx_post_searchs_updated_at` - æ›´æ–°æ—¶é—´ç´¢å¼•
- **ä½¿ç”¨æ¬¡æ•°**: 0 æ¬¡
- **ç´¢å¼•å¤§å°**: 112 kB
- **è¯´æ˜Ž**: ç”¨äºŽ `ORDER BY updated_at DESC`ï¼Œä½†å½“å‰æŸ¥è¯¢ä¸­æ²¡æœ‰ä½¿ç”¨
- **å»ºè®®**: âŒ **å»ºè®®åˆ é™¤**ï¼Œå¯ä»¥èŠ‚çœ 112 kB ç©ºé—´

#### 2. `idx_transfer_date` - è½¬å•æ—¥æœŸç´¢å¼•
- **ä½¿ç”¨æ¬¡æ•°**: 0 æ¬¡
- **ç´¢å¼•å¤§å°**: 48 kB
- **è¯´æ˜Ž**: ç”¨äºŽè½¬å•æ—¥æœŸæŸ¥è¯¢ï¼Œä½†å½“å‰æŸ¥è¯¢ä¸­æ²¡æœ‰ä½¿ç”¨
- **å»ºè®®**: âš ï¸ **å¯ä»¥è€ƒè™‘åˆ é™¤**ï¼Œå¦‚æžœæœªæ¥ä¸éœ€è¦æŒ‰è½¬å•æ—¥æœŸæŸ¥è¯¢ï¼Œå¯ä»¥èŠ‚çœ 48 kB ç©ºé—´

## ðŸ“ˆ æ€§èƒ½åˆ†æž

### ç´¢å¼•æ•ˆçŽ‡åˆ†æž

1. **`idx_post_searchs_ship_date_id`** (861æ¬¡ä½¿ç”¨)
   - å¹³å‡æ¯æ¬¡è¯»å–: 11.2 å…ƒç»„
   - å¹³å‡æ¯æ¬¡èŽ·å–: 10.1 å…ƒç»„
   - **æ•ˆçŽ‡**: âœ… å¾ˆé«˜ï¼Œç´¢å¼•ä½¿ç”¨éžå¸¸æœ‰æ•ˆ

2. **`idx_ship_date`** (394æ¬¡ä½¿ç”¨)
   - å¹³å‡æ¯æ¬¡è¯»å–: 111.1 å…ƒç»„
   - å¹³å‡æ¯æ¬¡èŽ·å–: 0.6 å…ƒç»„
   - **æ•ˆçŽ‡**: âœ… é«˜ï¼Œä¸»è¦ç”¨äºŽæ—¥æœŸèŒƒå›´ç­›é€‰

3. **`idx_states`** (2,058æ¬¡ä½¿ç”¨)
   - å¹³å‡æ¯æ¬¡è¯»å–: 185.8 å…ƒç»„
   - å¹³å‡æ¯æ¬¡èŽ·å–: 27.6 å…ƒç»„
   - **æ•ˆçŽ‡**: âœ… é«˜ï¼ŒçŠ¶æ€ç­›é€‰çš„æ ¸å¿ƒç´¢å¼•

## ðŸŽ¯ ä¼˜åŒ–å»ºè®®

### ç«‹å³æ‰§è¡Œ

1. **åˆ é™¤æœªä½¿ç”¨çš„ç´¢å¼•**ï¼ˆèŠ‚çœ 160 kB ç©ºé—´ï¼‰:
   ```sql
   -- åˆ é™¤æœªä½¿ç”¨çš„ç´¢å¼•
   DROP INDEX IF EXISTS idx_post_searchs_updated_at;
   DROP INDEX IF EXISTS idx_transfer_date;  -- å¦‚æžœç¡®å®šä¸éœ€è¦è½¬å•æ—¥æœŸæŸ¥è¯¢
   ```

2. **ä¿ç•™æ‰€æœ‰æ—¥æœŸç›¸å…³ç´¢å¼•**:
   - âœ… `idx_ship_date` - åŸºç¡€æ—¥æœŸç´¢å¼•ï¼ˆå¿…éœ€ï¼‰
   - âœ… `idx_post_searchs_ship_date_id` - æŽ’åºç´¢å¼•ï¼ˆæœ€é‡è¦ï¼‰
   - âœ… `idx_post_searchs_states_ship_date` - çŠ¶æ€+æ—¥æœŸå¤åˆç´¢å¼•
   - âœ… `idx_post_searchs_ship_date_states` - æ—¥æœŸ+çŠ¶æ€å¤åˆç´¢å¼•
   - âœ… `idx_post_searchs_states_ship_date_id` - çŠ¶æ€+æ—¥æœŸ+IDå¤åˆç´¢å¼•

### é•¿æœŸç›‘æŽ§

1. **ç›‘æŽ§ `idx_order_num` çš„ä½¿ç”¨æƒ…å†µ**:
   - å¦‚æžœé•¿æœŸä½¿ç”¨æ¬¡æ•° < 10ï¼Œå¯ä»¥è€ƒè™‘åˆ é™¤

2. **å®šæœŸæ£€æŸ¥ç´¢å¼•ä½¿ç”¨æƒ…å†µ**:
   - æ¯æœˆæ‰§è¡Œä¸€æ¬¡ `check_index_usage.sql`
   - åˆ é™¤é•¿æœŸæœªä½¿ç”¨çš„ç´¢å¼•ä»¥èŠ‚çœç©ºé—´

## ðŸ“ æ€»ç»“

### ç´¢å¼•ä½¿ç”¨æƒ…å†µè‰¯å¥½ âœ…

- **æ ¸å¿ƒç´¢å¼•ä½¿ç”¨é¢‘ç¹**: æ—¥æœŸç›¸å…³ç´¢å¼•ï¼ˆ`idx_ship_date`ã€`idx_post_searchs_ship_date_id`ï¼‰ä½¿ç”¨é¢‘ç¹ï¼Œè¯´æ˜Žé»˜è®¤æ—¥æœŸèŒƒå›´æŸ¥è¯¢ä¼˜åŒ–æˆåŠŸ
- **å¤åˆç´¢å¼•æœ‰æ•ˆ**: è™½ç„¶ä½¿ç”¨æ¬¡æ•°ä¸å¤šï¼Œä½†åœ¨ç‰¹å®šæŸ¥è¯¢åœºæ™¯ä¸‹å¾ˆæœ‰ç”¨
- **å­˜å‚¨ç©ºé—´åˆç†**: ç´¢å¼•æ€»å¤§å°çº¦ 800+ kBï¼Œåœ¨å¯æŽ¥å—èŒƒå›´å†…

### éœ€è¦ä¼˜åŒ–çš„ç‚¹ âš ï¸

- **2ä¸ªæœªä½¿ç”¨çš„ç´¢å¼•**: å¯ä»¥åˆ é™¤ä»¥èŠ‚çœç©ºé—´
- **1ä¸ªä½¿ç”¨è¾ƒå°‘çš„ç´¢å¼•**: éœ€è¦è¯„ä¼°æ˜¯å¦ä¿ç•™

### å»ºè®®

1. âœ… **ä¿ç•™æ‰€æœ‰æ—¥æœŸç›¸å…³ç´¢å¼•**ï¼ˆé»˜è®¤æ—¥æœŸèŒƒå›´æŸ¥è¯¢å¿…éœ€ï¼‰
2. âœ… **ä¿ç•™æ‰€æœ‰ä½¿ç”¨é¢‘ç¹çš„ç´¢å¼•**
3. âŒ **åˆ é™¤æœªä½¿ç”¨çš„ç´¢å¼•**ï¼ˆ`idx_post_searchs_updated_at`ã€`idx_transfer_date`ï¼‰
4. âš ï¸ **è¯„ä¼° `idx_order_num` æ˜¯å¦ä¿ç•™**

