# 📝 数据库配置说明

## 🔧 配置步骤

### 1. 配置环境变量

项目使用 `.env.local` 文件存储数据库配置信息。请按照以下步骤配置：

1. **打开 `.env.local` 文件**（如果不存在，请创建）

2. **填写您的数据库信息**：
   ```env
   DB_HOST=localhost          # 数据库主机地址
   DB_PORT=3306              # 数据库端口
   DB_USER=root              # 数据库用户名
   DB_PASSWORD=你的密码       # 数据库密码（重要！）
   DB_NAME=seas_ware         # 数据库名称
   ```

   ⚠️ **重要提示**：
   - 必须填写 `DB_PASSWORD`（您的 MySQL root 密码）
   - 如果密码为空，请填写 `DB_PASSWORD=`（留空但不删除这一行）
   - 不要将 `.env.local` 文件提交到 Git（已在 .gitignore 中）

### 2. 创建数据库

如果数据库 `seas_ware` 不存在，请在 MySQL 中执行：

```sql
CREATE DATABASE IF NOT EXISTS `seas_ware` 
DEFAULT CHARACTER SET utf8mb4 
COLLATE utf8mb4_unicode_ci;
```

### 3. 创建数据表

执行 SQL 脚本创建必要的表：

#### 3.1 创建 `post_searchs` 表（物流查询表）

```bash
# 方法 1：使用 MySQL 命令行
mysql -u root -p seas_ware < sql/create_post_searchs_table.sql

# 方法 2：使用 MySQL 客户端工具（如 Navicat、phpMyAdmin 等）
# 直接打开 sql/create_post_searchs_table.sql 文件并执行
```

或者手动执行 SQL：

```sql
USE `seas_ware`;

CREATE TABLE IF NOT EXISTS `post_searchs` (
  `id` INT AUTO_INCREMENT PRIMARY KEY COMMENT '主键ID',
  `search_num` VARCHAR(255) NOT NULL COMMENT '货运单号',
  `states` VARCHAR(100) DEFAULT NULL COMMENT '状态',
  `Ship_date` DATE DEFAULT NULL COMMENT '发货日期',
  `channel` VARCHAR(100) DEFAULT NULL COMMENT '渠道',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX `idx_search_num` (`search_num`),
  INDEX `idx_states` (`states`),
  INDEX `idx_ship_date` (`Ship_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='物流查询表';
```

### 4. 验证配置

配置完成后，重启开发服务器：

```bash
# 停止当前服务器（按 Ctrl + C）
# 然后重新启动
npm run dev
```

## 🔍 常见问题排查

### 问题 1：Access denied for user 'root'@'localhost' (using password: NO)

**原因**：数据库密码未配置或配置错误

**解决方案**：
1. 检查 `.env.local` 文件中的 `DB_PASSWORD` 是否已填写
2. 确认密码是否正确（注意大小写和特殊字符）
3. 重启开发服务器（环境变量修改后需要重启才能生效）

### 问题 2：数据库连接失败

**检查项**：
1. ✅ MySQL 服务是否已启动
   ```bash
   # Windows 检查服务
   # 打开"服务"管理器，查找 MySQL 服务，确保状态为"正在运行"
   ```

2. ✅ 数据库 `seas_ware` 是否存在
   ```sql
   SHOW DATABASES LIKE 'seas_ware';
   ```

3. ✅ 表 `post_searchs` 是否存在
   ```sql
   USE seas_ware;
   SHOW TABLES LIKE 'post_searchs';
   ```

4. ✅ 数据库配置是否正确
   - 检查 `.env.local` 文件中的配置
   - 确认用户名和密码是否正确

### 问题 3：表不存在错误

**错误信息**：`Table 'seas_ware.post_searchs' doesn't exist`

**解决方案**：
1. 执行 `sql/create_post_searchs_table.sql` 脚本创建表
2. 或手动执行上述创建表的 SQL 语句

### 问题 4：环境变量未生效

**原因**：Next.js 需要在启动时读取环境变量

**解决方案**：
1. 确保 `.env.local` 文件在项目根目录
2. 重启开发服务器（`npm run dev`）
3. 不要修改 `.env` 或其他文件名，Next.js 优先读取 `.env.local`

## 📋 配置检查清单

在启动项目前，请确认：

- [ ] MySQL 服务已启动
- [ ] 数据库 `seas_ware` 已创建
- [ ] 表 `post_searchs` 已创建
- [ ] `.env.local` 文件已创建并配置正确
- [ ] `DB_PASSWORD` 已填写（即使密码为空也要有这一行）
- [ ] 已重启开发服务器

## 🔐 安全提示

1. ⚠️ **不要将 `.env.local` 提交到 Git**
   - 该文件已在 `.gitignore` 中，但请再次确认
   - 包含敏感信息（数据库密码）

2. ⚠️ **使用强密码**
   - 生产环境请使用强密码
   - 不要使用默认密码

3. ⚠️ **限制数据库用户权限**
   - 生产环境建议创建专用数据库用户
   - 只授予必要的权限（SELECT, INSERT, UPDATE, DELETE）

## 🎯 快速配置命令

```bash
# 1. 创建并编辑 .env.local 文件
# （使用您喜欢的文本编辑器）

# 2. 创建数据库（如果不存在）
mysql -u root -p -e "CREATE DATABASE IF NOT EXISTS seas_ware DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"

# 3. 创建表
mysql -u root -p seas_ware < sql/create_post_searchs_table.sql

# 4. 重启开发服务器
npm run dev
```

配置完成后，项目应该能够正常连接到数据库了！🎉


