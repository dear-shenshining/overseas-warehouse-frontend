# ğŸ“Š æ»é”€åº“å­˜ç®¡ç† - å¤§ç›˜æ¨¡å—åŠŸèƒ½å®ç°åˆ†æ

> åˆ†æå¯¼å…¥æ•°æ®æ—¶çš„å®Œæ•´æµç¨‹å’ŒåŠŸèƒ½å®ç°

---

## âœ… åŠŸèƒ½å®ç°æ£€æŸ¥æ¸…å•

### 1ï¸âƒ£ å¯¼å…¥æ•°æ®æ—¶ï¼Œå†™å…¥æ•°æ®åº“å¹¶æ›´æ–°è´Ÿè´£äººåŠæ ‡è¯†

**å®ç°çŠ¶æ€**ï¼šâœ… **å·²å®ç°**

**ä»£ç ä½ç½®**ï¼š`lib/inventory-data.ts` â†’ `importInventoryData()`

**å®ç°ç»†èŠ‚**ï¼š

1. **å†™å…¥æ•°æ®åº“**ï¼š
   ```typescript
   // å¯¹äºå·²å­˜åœ¨çš„SKUï¼šUPDATE
   // å¯¹äºä¸å­˜åœ¨çš„SKUï¼šINSERT
   ```

2. **æ›´æ–°è´Ÿè´£äººï¼ˆchargeï¼‰**ï¼š
   ```typescript
   // åŒ¹é…è§„åˆ™ï¼š
   // 1. å¦‚æœ ware_sku åŒ…å« "ZMT"ï¼Œç›´æ¥è¿”å› "æœ±æ¢¦å©·"
   // 2. å¦åˆ™ï¼Œware_sku åŒ…å« per_charge.sku æ—¶ï¼Œè¿”å›å¯¹åº”çš„ charge
   // 3. å¦‚æœè®°å½•å·²å­˜åœ¨ä¸”å·²æœ‰ charge å€¼ï¼Œåˆ™ä¿æŒä¸å˜
   ```

3. **æ›´æ–°æ ‡è¯†ï¼ˆlabelï¼‰**ï¼š
   ```typescript
   // æ ¹æ®åº“å­˜æ•°é‡å’Œé”€é‡è‡ªåŠ¨è®¡ç®— label
   ```

---

### 2ï¸âƒ£ è¿›è¡Œåˆ†ç±»ï¼ˆæ ‡è¯†è®¡ç®—ï¼‰

**å®ç°çŠ¶æ€**ï¼šâœ… **å·²å®ç°**

**ä»£ç ä½ç½®**ï¼š`app/actions/inventory.ts` â†’ `calculateInventoryData()`

**åˆ†ç±»è§„åˆ™**ï¼š

| æ ‡è¯† | æ¡ä»¶ | è¯´æ˜ |
|------|------|------|
| **1** | `inventory_num === 0` | æ— åº“å­˜ |
| **2** | `sales_num === 0` | æ— é”€é‡ |
| **3** | `sales_num > 300` | çˆ†æ¬¾ |
| **4** | `sale_day > 15`ï¼ˆéçˆ†æ¬¾ï¼‰<br>æˆ– `sale_day > 30`ï¼ˆçˆ†æ¬¾ï¼‰ | åœ¨å”®å¤©æ•°é¢„è­¦ |
| **5** | `inventory_num < 0` | åº“å­˜å¾…å†²å¹³ |

**è®¡ç®—é€»è¾‘**ï¼š
```typescript
// å¯å”®å¤©æ•°è®¡ç®—
sale_day = (inventory_num * 7) / sales_num  // å¦‚æœ sales_num > 0

// æ ‡ç­¾è®¡ç®—
if (inventory_num === 0) labels.push(1)
if (sales_num === 0) labels.push(2)
if (sales_num > 300) labels.push(3)
if (sale_day > 15 ä¸”éçˆ†æ¬¾) labels.push(4)
if (sale_day > 30 ä¸”çˆ†æ¬¾) labels.push(4)
if (inventory_num < 0) labels.push(5)
```

---

### 3ï¸âƒ£ åœ¨å”®å¤©æ•°è¶…è¿‡åäº”å¤©çš„ï¼Œå†™å…¥ä»»åŠ¡åŠæ—¶é™çš„è¡¨æ ¼

**å®ç°çŠ¶æ€**ï¼šâœ… **å·²å®ç°**

**ä»£ç ä½ç½®**ï¼š`lib/inventory-data.ts` â†’ `syncInventoryToTask()`

**åŒæ­¥æ¡ä»¶**ï¼š
- âœ… `label` åŒ…å« **4**ï¼ˆåœ¨å”®å¤©æ•°é¢„è­¦ï¼‰
- âœ… æˆ–è€… `label` åŒ…å« **2** ä½†ä¸åŒ…å« **1** ä¸”ä¸åŒ…å« **5**ï¼ˆæœ‰åº“å­˜æ— é”€é‡ï¼‰

**åŒæ­¥æ—¶æœº**ï¼š
- âœ… å¯¼å…¥æ•°æ®å®Œæˆåè‡ªåŠ¨è°ƒç”¨ `syncInventoryToTask()`
- âœ… ç‚¹å‡»"åˆ·æ–°ä»»åŠ¡è¡¨"æŒ‰é’®æ—¶ä¹Ÿä¼šåŒæ­¥

**åŒæ­¥é€»è¾‘**ï¼š
```typescript
// 1. æ¸…ç©º task è¡¨
DELETE FROM task

// 2. æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„è®°å½•
SELECT * FROM inventory 
WHERE (label åŒ…å« 4) 
   OR (label åŒ…å« 2 ä¸” ä¸åŒ…å« 1 ä¸” ä¸åŒ…å« 5)

// 3. æ’å…¥åˆ° task è¡¨
INSERT INTO task (...)
```

**æ³¨æ„**ï¼š
- åŒæ­¥æ¡ä»¶æ˜¯åŸºäº `label` è€Œä¸æ˜¯ç›´æ¥åŸºäº `sale_day > 15`
- `label` åŒ…å« 4 è¡¨ç¤ºåœ¨å”®å¤©æ•°é¢„è­¦ï¼Œè¿™é€šå¸¸æ„å‘³ç€ `sale_day > 15`ï¼ˆéçˆ†æ¬¾ï¼‰æˆ– `sale_day > 30`ï¼ˆçˆ†æ¬¾ï¼‰

---

### 4ï¸âƒ£ åœ¨å”®å¤©æ•°å˜æ›´ä¸ºä½äºåäº”å¤©çš„ï¼Œç§»å‡ºä»»åŠ¡åŠæ—¶é™ï¼Œå¹¶ä¸”æ”¾åˆ°å†å²ä»»åŠ¡ä¸­

**å®ç°çŠ¶æ€**ï¼šâœ… **å·²å®ç°**

**ä»£ç ä½ç½®**ï¼š`lib/inventory-data.ts` â†’ `importInventoryData()` (ç¬¬ 155-184 è¡Œ)

**æ£€æµ‹é€»è¾‘**ï¼š
```typescript
// æ£€æµ‹ä»»åŠ¡å®Œæˆæ¡ä»¶ï¼š
// 1. è¯¥SKUåœ¨ task è¡¨ä¸­å­˜åœ¨
// 2. æ—§çš„ sale_day >= 15
// 3. æ–°çš„ sale_day < 15

if (existingTask.length > 0 
    && oldSaleDay !== null 
    && oldSaleDay >= 15 
    && newSaleDay !== null 
    && newSaleDay < 15) {
  // ä»»åŠ¡å®Œæˆï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
  // 1. ä¿å­˜åˆ° task_history è¡¨
  // 2. ä» task è¡¨åˆ é™¤
}
```

**å®ç°æ­¥éª¤**ï¼š

1. **ä¿å­˜åˆ°å†å²ä»»åŠ¡è¡¨**ï¼š
   ```typescript
   INSERT INTO task_history (
     ware_sku, 
     completed_sale_day,  // å®Œæˆæ—¶çš„å¯å”®å¤©æ•°ï¼ˆæ–°çš„å€¼ï¼‰
     charge, 
     promised_land,
     inventory_num, 
     sales_num, 
     label, 
     completed_at
   ) VALUES (...)
   ```

2. **ä»ä»»åŠ¡è¡¨åˆ é™¤**ï¼š
   ```typescript
   DELETE FROM task WHERE ware_sku = ?
   ```

---

## ğŸ“‹ å®Œæ•´æµç¨‹æ€»ç»“

### å¯¼å…¥æ•°æ®æ—¶çš„å®Œæ•´æµç¨‹ï¼š

```
1. ç”¨æˆ·ä¸Šä¼  Excel æ–‡ä»¶
   â†“
2. è§£æ Excel æ–‡ä»¶
   â†“
3. æŒ‰ SKU åˆ†ç»„å¹¶è®¡ç®—ï¼š
   - inventory_numï¼ˆåº“å­˜æ•°é‡ï¼‰
   - sales_numï¼ˆæœ€è¿‘ä¸ƒå¤©é”€é‡ï¼‰
   - sale_dayï¼ˆå¯å”®å¤©æ•°ï¼‰
   - labelï¼ˆæ ‡è¯†åˆ†ç±»ï¼‰
   â†“
4. å¯¹æ¯ä¸ª SKUï¼š
   a. æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
   b. åŒ¹é…è´Ÿè´£äººï¼ˆä» per_charge è¡¨ï¼‰
   c. æ£€æµ‹ä»»åŠ¡å®Œæˆï¼ˆsale_day >= 15 å˜ä¸º < 15ï¼‰
      - å¦‚æœå®Œæˆï¼šä¿å­˜åˆ° task_historyï¼Œä» task åˆ é™¤
   d. æ‰§è¡Œ INSERT æˆ– UPDATE
   â†“
5. æäº¤äº‹åŠ¡
   â†“
6. åŒæ­¥æ•°æ®åˆ° task è¡¨ï¼ˆlabel åŒ…å« 4 æˆ– label åŒ…å« 2 ä½†ä¸åŒ…å« 1 ä¸”ä¸åŒ…å« 5ï¼‰
   â†“
7. è¿”å›å¯¼å…¥ç»“æœ
```

---

## âš ï¸ éœ€è¦æ³¨æ„çš„ç‚¹

### 1. åŒæ­¥åˆ°ä»»åŠ¡è¡¨çš„æ¡ä»¶

**å½“å‰å®ç°**ï¼šåŸºäº `label` åŒ…å« 4ï¼Œè€Œä¸æ˜¯ç›´æ¥åŸºäº `sale_day > 15`

**åŸå› **ï¼š
- `label` åŒ…å« 4 è¡¨ç¤º"åœ¨å”®å¤©æ•°é¢„è­¦"
- å¯¹äºéçˆ†æ¬¾ï¼š`sale_day > 15` æ—¶ label ä¼šåŒ…å« 4
- å¯¹äºçˆ†æ¬¾ï¼š`sale_day > 30` æ—¶ label æ‰ä¼šåŒ…å« 4

**è¿™æ„å‘³ç€**ï¼š
- âœ… éçˆ†æ¬¾ä¸” `sale_day > 15` â†’ ä¼šåŒæ­¥åˆ° task è¡¨
- âœ… çˆ†æ¬¾ä¸” `sale_day > 30` â†’ ä¼šåŒæ­¥åˆ° task è¡¨
- âŒ çˆ†æ¬¾ä¸” `15 < sale_day <= 30` â†’ ä¸ä¼šåŒæ­¥åˆ° task è¡¨

### 2. ä»»åŠ¡å®Œæˆçš„æ£€æµ‹

**å½“å‰å®ç°**ï¼šæ£€æµ‹ `sale_day >= 15` å˜ä¸º `sale_day < 15`

**è¿™æ„å‘³ç€**ï¼š
- âœ… å¦‚æœ `sale_day` ä» 20 å˜ä¸º 10 â†’ ä¼šç§»åŠ¨åˆ°å†å²ä»»åŠ¡
- âœ… å¦‚æœ `sale_day` ä» 15 å˜ä¸º 14 â†’ ä¼šç§»åŠ¨åˆ°å†å²ä»»åŠ¡
- âŒ å¦‚æœ `sale_day` ä» 16 å˜ä¸º 15 â†’ ä¸ä¼šç§»åŠ¨åˆ°å†å²ä»»åŠ¡ï¼ˆå› ä¸ºæ¡ä»¶è¦æ±‚ < 15ï¼‰

### 3. è´Ÿè´£äººæ›´æ–°é€»è¾‘

**å½“å‰å®ç°**ï¼š
- å¦‚æœè®°å½•å·²å­˜åœ¨ä¸”å·²æœ‰ `charge` å€¼ â†’ **ä¿æŒä¸å˜**
- å¦‚æœè®°å½•ä¸å­˜åœ¨æˆ– `charge` ä¸ºç©º â†’ ä» `per_charge` è¡¨åŒ¹é…

**è¿™æ„å‘³ç€**ï¼š
- âœ… æ–°å¯¼å…¥çš„è®°å½•ä¼šè‡ªåŠ¨åŒ¹é…è´Ÿè´£äºº
- âœ… å·²å­˜åœ¨çš„è®°å½•ä¸ä¼šè¦†ç›–å·²æœ‰è´Ÿè´£äºº
- âš ï¸ å¦‚æœéœ€è¦æ›´æ–°å·²æœ‰è®°å½•çš„è´Ÿè´£äººï¼Œéœ€è¦æ‰‹åŠ¨æ‰§è¡Œ SQL

---

## ğŸ¯ åŠŸèƒ½å®ç°æ€»ç»“

| éœ€æ±‚ | å®ç°çŠ¶æ€ | ä»£ç ä½ç½® | å¤‡æ³¨ |
|------|---------|---------|------|
| 1. å¯¼å…¥æ•°æ®å†™å…¥æ•°æ®åº“ | âœ… | `importInventoryData()` | INSERT/UPDATE |
| 2. æ›´æ–°è´Ÿè´£äºº | âœ… | `importInventoryData()` | ä» per_charge åŒ¹é… |
| 3. æ›´æ–°æ ‡è¯† | âœ… | `calculateInventoryData()` | è‡ªåŠ¨è®¡ç®— label |
| 4. åˆ†ç±»ï¼ˆæ ‡è¯†ï¼‰ | âœ… | `calculateInventoryData()` | 5 ç§æ ‡è¯† |
| 5. åŒæ­¥åˆ°ä»»åŠ¡è¡¨ | âœ… | `syncInventoryToTask()` | label åŒ…å« 4 æˆ–ç‰¹å®šæ¡ä»¶ |
| 6. ä»»åŠ¡å®Œæˆæ£€æµ‹ | âœ… | `importInventoryData()` | sale_day >= 15 å˜ä¸º < 15 |
| 7. ç§»åŠ¨åˆ°å†å²ä»»åŠ¡ | âœ… | `importInventoryData()` | ä¿å­˜åˆ° task_history |
| 8. ä»ä»»åŠ¡è¡¨åˆ é™¤ | âœ… | `importInventoryData()` | åˆ é™¤å·²å®Œæˆä»»åŠ¡ |

---

## ğŸ“ ç»“è®º

**æ‰€æœ‰éœ€æ±‚éƒ½å·²å®ç°** âœ…

ä»£ç é€»è¾‘å®Œæ•´ï¼Œæ¶µç›–äº†ï¼š
- âœ… æ•°æ®å¯¼å…¥å’Œæ›´æ–°
- âœ… è´Ÿè´£äººåŒ¹é…
- âœ… æ ‡è¯†åˆ†ç±»
- âœ… ä»»åŠ¡è¡¨åŒæ­¥
- âœ… ä»»åŠ¡å®Œæˆæ£€æµ‹å’Œå†å²è®°å½•

**å”¯ä¸€éœ€è¦æ³¨æ„çš„ç‚¹**ï¼š
- åŒæ­¥åˆ°ä»»åŠ¡è¡¨çš„æ¡ä»¶æ˜¯åŸºäº `label` åŒ…å« 4ï¼Œè€Œä¸æ˜¯ç›´æ¥åŸºäº `sale_day > 15`
- å¯¹äºçˆ†æ¬¾å•†å“ï¼Œéœ€è¦ `sale_day > 30` æ‰ä¼šåŒæ­¥åˆ°ä»»åŠ¡è¡¨

