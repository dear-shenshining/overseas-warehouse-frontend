# 登录功能说明

## 📋 功能概述

系统已添加登录功能，访问 `https://www.jinyanyan.top/login` 可以登录系统。

## 🔐 登录配置

### 环境变量配置

在 `.env.local` 或 `.env` 文件中添加以下配置：

```env
# 管理员用户名（默认：admin）
ADMIN_USERNAME=admin

# 管理员密码（默认：admin123）
ADMIN_PASSWORD=your_secure_password
```

**⚠️ 重要提示**：
- 生产环境请务必修改默认密码
- 密码建议使用强密码（至少 12 位，包含大小写字母、数字和特殊字符）
- 不要将 `.env` 文件提交到 Git 仓库

### 默认凭据

如果未设置环境变量，系统使用以下默认值：
- **用户名**：`admin`
- **密码**：`admin123`

---

## 🚀 使用说明

### 1. 登录

1. 访问 `https://www.jinyanyan.top/login`
2. 输入用户名和密码
3. 点击"登录"按钮

### 2. 登出

在系统主页面左侧边栏底部，点击"登出"按钮即可退出登录。

### 3. 自动重定向

- **未登录访问其他页面**：自动重定向到登录页
- **已登录访问登录页**：自动重定向到首页

---

## 🔒 安全机制

### 1. Session 管理

- 使用 HTTP-only Cookie 存储 session token（防止 XSS 攻击）
- Session 有效期：30 天
- 生产环境自动启用 Secure Cookie（HTTPS only）

### 2. 路由保护

- 所有页面（除登录页）都需要登录才能访问
- 使用 Next.js Middleware 自动检查认证状态
- API 路由不受保护（可根据需要调整）

### 3. 密码安全

- 密码存储在环境变量中，不会暴露在前端代码
- 建议定期更换密码

---

## 📁 文件结构

```
app/
├── login/
│   └── page.tsx          # 登录页面
├── actions/
│   └── auth.ts           # 认证相关的 Server Actions
└── page.tsx               # 主页面（已添加登出功能）

middleware.ts              # 路由保护中间件
```

---

## 🛠️ 技术实现

### 1. 登录流程

```
用户输入用户名密码
    ↓
Server Action 验证（app/actions/auth.ts）
    ↓
验证成功 → 设置 Cookie
    ↓
重定向到首页
```

### 2. 认证检查

```
用户访问页面
    ↓
Middleware 检查 Cookie（middleware.ts）
    ↓
有 Cookie → 允许访问
无 Cookie → 重定向到登录页
```

### 3. 登出流程

```
用户点击登出
    ↓
Server Action 清除 Cookie（app/actions/auth.ts）
    ↓
重定向到登录页
```

---

## 🔧 自定义配置

### 修改 Session 有效期

编辑 `app/actions/auth.ts`：

```typescript
cookieStore.set('session_token', sessionToken, {
  // ...
  maxAge: 60 * 60 * 24 * 30, // 修改这里的数字（秒）
  // ...
})
```

### 修改路由保护规则

编辑 `middleware.ts` 中的 `config.matcher`：

```typescript
export const config = {
  matcher: [
    // 添加需要排除的路径
    '/((?!api|_next/static|_next/image|favicon.ico|public).*)',
  ],
}
```

---

## ⚠️ 注意事项

1. **生产环境配置**
   - 务必在 Vercel 环境变量中设置 `ADMIN_USERNAME` 和 `ADMIN_PASSWORD`
   - 不要使用默认密码

2. **Cookie 安全**
   - 生产环境会自动启用 Secure Cookie（需要 HTTPS）
   - 开发环境使用 HTTP，Cookie 不会自动加密

3. **Session 管理**
   - 当前实现使用简单的 Base64 编码，适合小型应用
   - 大型应用建议使用 JWT 或专业的 Session 管理库

4. **多用户支持**
   - 当前实现仅支持单用户
   - 如需多用户支持，需要添加数据库存储用户信息

---

## 🐛 故障排查

### 问题 1：无法登录

**可能原因**：
- 环境变量未设置或设置错误
- Cookie 被浏览器阻止

**解决方法**：
1. 检查 `.env.local` 文件中的 `ADMIN_USERNAME` 和 `ADMIN_PASSWORD`
2. 清除浏览器 Cookie 后重试
3. 检查浏览器控制台是否有错误信息

### 问题 2：登录后立即被重定向

**可能原因**：
- Cookie 设置失败
- Middleware 配置错误

**解决方法**：
1. 检查浏览器开发者工具中的 Cookie 是否已设置
2. 检查 `middleware.ts` 中的配置是否正确

### 问题 3：无法登出

**可能原因**：
- Server Action 执行失败
- Cookie 清除失败

**解决方法**：
1. 检查浏览器控制台是否有错误信息
2. 手动清除浏览器 Cookie 后重试

---

## 📝 更新日志

- **2024-XX-XX**：初始版本
  - 添加登录页面
  - 添加路由保护
  - 添加登出功能

---

## 🔮 未来改进

- [ ] 添加"记住我"功能
- [ ] 添加密码重置功能
- [ ] 添加多用户支持
- [ ] 添加登录日志
- [ ] 添加登录失败次数限制
- [ ] 使用 JWT 替代简单 Session Token










