-- ============================================================
-- 删除 orders 表的数据
-- PostgreSQL 版本
-- 注意：此操作只删除表中的数据记录，表结构、索引、触发器、约束等都会保留
-- 警告：此操作会删除表中的所有记录，且不可恢复，执行前请确保已备份数据
-- ============================================================

-- ============================================================
-- 执行前检查
-- ============================================================

-- 1. 查看表是否存在
-- SELECT EXISTS (
--     SELECT FROM information_schema.tables 
--     WHERE table_schema = 'public' 
--     AND table_name = 'orders'
-- );

-- 2. 查看表中的数据量
-- SELECT COUNT(*) FROM orders;

-- ============================================================
-- 删除操作（推荐使用最快的方法）
-- ============================================================

-- 方法1：使用 TRUNCATE 删除所有数据（最快的方法，推荐！）
-- 只删除数据，表结构、索引、触发器、约束等保持不变
-- 速度比 DELETE 快几十倍，适合大量数据删除
-- CASCADE：如果有外键约束，自动处理依赖关系
-- RESTART IDENTITY：重置自增序列（SERIAL/IDENTITY）从 1 开始
TRUNCATE TABLE orders RESTART IDENTITY CASCADE;

-- 方法2：如果不需要重置序列，使用这个（更快一点）
-- TRUNCATE TABLE orders CASCADE;

-- 方法3：如果表没有外键约束，可以不用 CASCADE（最快）
-- TRUNCATE TABLE orders RESTART IDENTITY;

-- 方法4：使用 DELETE 删除所有数据（可以回滚，但速度很慢，不推荐）
-- 只删除数据，表结构、索引、触发器、约束等保持不变
-- 如果数据量很大，此方法可能非常慢（可能需要几小时）
-- DELETE FROM orders;

-- ============================================================
-- 执行后验证
-- ============================================================

-- 验证数据是否已清空
-- SELECT COUNT(*) FROM orders;
-- 如果返回 0，说明数据已成功删除

-- 验证表结构是否保留
-- SELECT column_name, data_type 
-- FROM information_schema.columns 
-- WHERE table_name = 'orders';
-- 如果返回列信息，说明表结构已保留

-- ============================================================
-- 注意事项
-- ============================================================
-- 
-- 1. 删除数据前请务必备份数据
-- 2. TRUNCATE 是最快的方法：
--    - 比 DELETE 快几十倍甚至上百倍
--    - 直接释放数据页，不逐行删除
--    - 不记录每行删除到 WAL，减少日志开销
--    - 适合删除大量数据（百万、千万级）
-- 3. DELETE vs TRUNCATE 对比：
--    - DELETE：可以回滚，但速度慢（逐行删除，记录日志）
--    - TRUNCATE：无法回滚，但速度极快（直接释放数据页）
-- 4. CASCADE 选项：
--    - 自动处理外键约束的依赖关系
--    - 如果有其他表通过外键引用 orders，会自动处理
-- 5. RESTART IDENTITY 选项：
--    - 重置自增序列（SERIAL/IDENTITY）从 1 开始
--    - 如果不需要重置序列，可以去掉此选项
-- 6. 删除数据后，表结构、索引、触发器、约束等都会保留
-- 7. 此操作会删除所有数据，请在生产环境谨慎执行
-- 
-- ============================================================

